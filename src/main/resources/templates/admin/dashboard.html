<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://thymeleaf.org">
<head th:replace="fragments/head"/>
<body>
<!-- Barra de Navegación superior -->
<nav th:replace="fragments/nav"/>

<div class="container">
    <h2 class="my-3">Listado de logs</h2>

    <div class="d-flex flex-row justify-content-start mb-5">

        <div class="col-md-4">
            <a class="btn btn-dark mb-4" href="/admin/logs/deleteAll"
               title="Eliminar todos los logs registrados hasta la fecha">Eliminar
                logs
                <span class="badge badge-light" th:text="${logs.size()}"></span>
            </a>
        </div>
        <form action="/admin/logs/filter" method="GET"
              class="d-flex flex-row justify-content-start mb-4 gap-3">
            <select class="form-select form-select-lg mb-3"
                    name="logType">
                <option selected value="TODO">Mostrar todo</option>
                <option value="PET">PET</option>
                <option value="ALTA">ALTA</option>
                <option value="LOGIN-EX">LOGIN-EX</option>
                <option value="LOGIN-ERR">LOGIN-ERR</option>
                <option value="LOGOUT">LOGOUT</option>
            </select>
            <div class="form-group">
                <input type="submit" class="btn btn-primary" value="Filtrar">
            </div>
        </form>
    </div>


    <table th:if="${logs.size() > 0}" class="table table-striped px-3 my-3"
           th:fragment="tableLogs">
        <thead class="thead-dark">
        <tr>
            <th scope="col" title="Tipo de petición">Tipo</th>
            <th scope="col" title="Método HTTP de la petición">Método</th>
            <th scope="col" title="URL del endpoint consultado">URL</th>
            <th scope="col" title="Código de estado HTTP">Código HTTP</th>
            <th scope="col" title="Parámetros recibidos">Parámetros</th>
            <th scope="col"
                title="Dirección IP desde donde se realiza la petición">IP
            </th>
            <th scope="col" title="Idioma del recurso solicitado">Idioma</th>
            <th scope="col" title="Fecha y hora cuando tuvo lugar la consulta">
                Fecha y hora
            </th>
            <th scope="col" title="Nombre del usuario que realizó la petición">
                Usuario
            </th>
        </tr>
        </thead>
        <tbody>

        <tr th:each="log : ${logs}"
            th:attr="class=${log.httpMethod == 'POST' ? 'table-warning'
            : log.httpMethod == 'DELETE' ? 'table-danger' : ''}">
            <td scope="row">
                <span class="badge badge-pill badge-primary"
                      th:text="${log.logType}"></span>
            </td>
            <td scope="row" th:text="${log.httpMethod}"></td>
            <td scope="row" th:text="${log.endPoint}"></td>
            <td scope="row" th:text="${log.responseStatusCode}"></td>
            <td scope="row"
                th:if="${log.requestParams != null && log.requestParams.length > 0}"
                th:text="${log.requestParams}"></td>
            <td scope="row"
                th:if="${log.requestParams == null || log.requestParams.length == 0}">
                -
            </td>
            <td scope="row" th:text="${log.remoteAddr}"></td>
            <td scope="row" th:text="${log.responseLocale}"></td>
            <td scope="row" th:text="${log.createdAt}"></td>
            <td scope="row" th:if="${log.username != 'anonymous'}"
                th:text="${log.username}"></td>
        </tr>
        </tbody>
    </table>
    <div th:if="${logs.size() == 0}" class="container">
        <h3>No hay logs</h3>
    </div>
</div>
<footer th:replace="fragments/footer"/>
</body>
</html>